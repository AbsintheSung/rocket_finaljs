import{h as q,b,a as i,l as A,t as D}from"./swal-46d26614.js";function h(e){c3.generate({bindto:"#chart",data:{columns:e,type:"pie"},color:{pattern:["#DACBFF","#9D7FEA","#5434A7","#301E5F"]}})}function w(e){if(e.length===0)return[];let t=[];return e.forEach(function(n){t.push(n.products)}),t.reduce(function(n,s){return n.concat(s)},[])}function E(e){if(e.length===0)return[];const t=w(e),r=[];let n=t.reduce(function(s,a){return a.category in s?s[a.category]=s[a.category]+a.price*a.quantity:s[a.category]=a.price*a.quantity,s},{});for(let s in n)r.push([s,n[s]]);return r}function v(e){if(e.length===0)return[];let r=w(e).reduce(function(c,o){return o.title in c?c[o.title]=c[o.title]+o.price*o.quantity:c[o.title]=o.price*o.quantity,c},{}),n=Object.entries(r).sort((c,o)=>o[1]-c[1]),s=n.slice(0,3),a=n.slice(3).reduce((c,o)=>c+o[1],0);return s.push(["其他",a]),s}function $(e){const t=v(e);h(t)}const O=document.querySelector(".admin-table"),L=document.querySelector(".deleteAllBtn"),S=document.querySelector(".section-revenue"),k=document.querySelector(".no_found-section"),B=document.querySelector(".table-container"),l="yixuan",F="NSLFr23079QQBaddgrqdWj7Gau53",p="https://livejs-api.hexschool.io/api/livejs/v1/admin",f={headers:{Authorization:`${F}`}},d=[];function x(e){let t=new Date(e*1e3);return`<p>${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}</p>`}function U(e){let t="";return e.forEach(function(r){let n=r.price*r.quantity;t+=`<p><span>${r.title}(${r.price})</span> * <span>${r.quantity}</span></p><br>
        <p>共:${n}元</p><br>`}),t}function j(e){return e?"已處理":"未處理"}function u(e){const t=document.querySelector(".admin-table tbody");let r="";e.forEach(function(n){let s=j(n.paid),a=U(n.products),c=x(n.createdAt);r+=`<tr>
                <td>${n.id}</td>
                <td>
                    <p>${n.user.name}</p>
                    <p>${n.user.tel}</p>
                </td>
                <td>${n.user.address}</td>
                <td>${n.user.email}</td>
                <td>
                    ${a}
                </td>
                <td>${c}</td>
                <td>
                    <button class="orderStatus" value="status"  data-status=${n.paid} data-id=${n.id}>${s}</button>
                </td>
                <td>
                    <button class="deleteOneBtn" value="delete"  data-id=${n.id}>刪除</button>
                </td>
            </tr>`}),t.innerHTML=r}function y(e){d.splice(0,d.length),e.forEach(t=>d.push(t))}function g(){k.style.display=d.length===0?"block":"none",S.style.display=d.length===0?"none":"block",B.style.display=d.length===0?"none":"block"}async function m(e){const t=`${p}/${l}/orders/${e}`;try{const r=await i.delete(t,f);return y(r.data.orders),r.data.orders}catch(r){throw r.response.data.message}}async function C(){const e=`${p}/${l}/orders/`;try{const t=await i.delete(e,f);return y(t.data.orders),t.data.orders}catch(t){throw t.response.data.message}}async function I(e,t){const r=`${p}/${l}/orders`,n={data:{id:`${e}`,paid:t}};try{const s=await i.put(r,n,f);return y(s.data.orders),s.data.orders}catch(s){throw console.log(s),s.response.data.message}}async function T(){const e=`${p}/${l}/orders`;try{g(),A();const t=await i.get(e,f);t.status===200&&(u(t.data.orders),y(t.data.orders),D("success","加載完成"))}catch(t){t.response.status===403||t.response.status===404?sweetalert(t.response.data.message,"錯誤通知","error"):sweetalert("取得失敗，請聯絡服務商","錯誤通知","error")}}O.addEventListener("click",async function(t){if(t.target.classList.contains("orderStatus")){const r=t.target.getAttribute("data-id"),n=t.target.getAttribute("data-status"),s=await q(I,r,n);s===void 0||u(s.value)}if(t.target.classList.contains("deleteOneBtn")){const r=t.target.getAttribute("data-id"),n=await b(m,r);n===void 0||u(n.value),n===void 0||$(n.value),g()}});L.addEventListener("click",async function(){const e=await b(C);e===void 0||u(e.value),e===void 0||$(e.value),g()});S.addEventListener("change",function(e){if(e.target.value==="類別營收比重"){const t=E(d);h(t)}if(e.target.value==="全品項營收比重"){const t=v(d);h(t)}});async function M(){await T(),document.querySelector("body").style.paddingRight="0px",$(d),g()}M();
